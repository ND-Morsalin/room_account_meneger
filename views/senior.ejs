<%- include('./partials/header.ejs'); %>

<div class="container ">
    <header class="header">
        <h2 class="room-name"><%= member.name %> </h2>

        <div class="menu">
            <div class="menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>
</div>
<div class="container">
    <h3 class="text-center pt-5"> Room member list</h3>
    <div class="room-table table-responsive">

        <table class="table table-hover table-dark table-borderless">
            <thead>
                <tr>
                    <th> BD </th>
                    <th> Rank </th>
                    <th> Name </th>
                    <th> Phone </th>
                    <th> Section </th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

</div>

<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
</script>

<script src="js/script.js"></script>

<script>
    const tbody = document.getElementById('tbody');


    const month = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August',
        'September', 'October', 'November', 'December'
    ]
    // get all members
    async function getAllMembers() {
        const response = await fetch('/allMember', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                thismonth: month[new Date().getMonth()]
            },
        });
        const result = await response.json();

        result.allMember.forEach((member) => {
            const bdnumber = member ? .bdnumber || '000',
                rank = member ? .rank || '---',
                name = member ? .name || '---',
                phone = member ? .phone || '---',
                section = member ? .section || '---';

            let tr = `<tr>
                        <td>${bdnumber} </td>
                        <td> ${rank}</td>
                        <td> ${name}</td>
                        <td> ${phone}</td>
                        <td>  ${section} </td>
                    </tr>`
            tbody.insertAdjacentHTML("beforeend", tr);
        })

        result.goods.forEach((echGoods) => {

            let tr = `<tr>
                <td>
                    <div class="items-list">
                        ${Object.keys(echGoods.goodsNames)}
                    </div>
                    <p class="m-0">
                        ${echGoods.boughtBy.name}, ${echGoods.buyingDate}
                    </p>
                </td>
                <td>
                    <h3 class="items-price">${echGoods.totalPrice}</h3>
                </td>
            </tr>`
            displayGoodsTbody.insertAdjacentHTML("beforeend", tr);
        })

    }
    getAllMembers()
</script>


</body>

</html>