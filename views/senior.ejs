<%- include('./partials/header.ejs'); %>

<div class="container ">
    <header class="header">
        <h2 class="room-name"><%= member.name %> </h2>

        <div class="menu">
            <div class="menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>
</div>
<div class="container">
    <h3 class="text-center pt-5"> Room member list</h3>
    <div class="room-table table-responsive">

        <table class="table table-hover table-dark table-borderless">
            <thead>
                <tr>
                    <th> BD </th>
                    <th> Rank </th>
                    <th> Name </th>
                    <th> Phone </th>
                    <th> Section </th>
                    <th> Delete Member </th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<!-- Pending Deposit balance -->
<div class="container">
    <div class="pendingDepositSection">
        <h3 class="text-center pt-5"> Pending Deposit list</h3>
        <div class="room-table table-responsive">
    
            <table class="table table-hover table-dark table-borderless">
                <thead>
                    <tr>
                        <th> BD </th>
                        <th> Name </th>
                        <th> Amount </th>
                        <th> Accept </th>
                        <th> Delete </th>
                    </tr>
                </thead>
                <tbody id="depositTbody"></tbody>
            </table>
        </div>
    </div>
</div>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
</script>

<script src="js/script.js"></script>

<script>
    const tbody = document.getElementById('tbody');
    const depositTbody = document.getElementById('depositTbody');


    const month = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August',
        'September', 'October', 'November', 'December'
    ]
    // get all members
    async function getAllMembers() {
        const response = await fetch('/allMember', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                thismonth: month[new Date().getMonth()]
            },
        });
        const result = await response.json();

        result.allMember.forEach((member) => {
            const bdnumber = member?.bdnumber || '000',
                rank = member?.rank || '---',
                name = member?.name || '---',
                phone = member?.phone || '---',
                section = member?.section || '---';

            let tr = `<tr>
                        <td>${bdnumber} </td>
                        <td> ${rank}</td>
                        <td> ${name}</td>
                        <td> ${phone}</td>
                        <td>  ${section} </td>
                        <td > <button data-bd="${bdnumber}" class="btn btn-danger"> Delete </button> </td>
                    </tr>`
            tbody.insertAdjacentHTML("beforeend", tr);
        })

    }
    getAllMembers()// get all members
    
    
    async function getAllPendingDeposit() {
        
        const response = await fetch('/getAllPendingDeposit', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                thismonth: month[new Date().getMonth()]
            },
        });
        const result = await response.json();
        console.log(result);
/* 
        result.allPendingDeposit.forEach((pendingDeposit) => {
            const bdnumber = pendingDeposit?.depositBy?.bdnumber || '000',
                name = pendingDeposit?.depositBy?.name || '---',
                depositBalance = pendingDeposit?.depositBalance || 0,
                section = member?.section || '---';

            let tr = `<tr>
                        <td>${bdnumber} </td>
                        <td> ${name}</td>
                        <td> ${depositBalance}</td>

                        <td>  <button onclick="acceptPendingDeposit(${pendingDeposit._id})" data-bd="${bdnumber}" class="btn btn-danger"> Delete </button></td>

                        <td > <button onclick="deletePendingDeposit(${pendingDeposit._id})" data-bd="${bdnumber}" class="btn btn-danger"> Delete </button> </td>
                    </tr>`
                    depositTbody.insertAdjacentHTML("beforeend", tr);
        }) */

    }
    getAllPendingDeposit()


    function acceptPendingDeposit(){
        alert('Accept')
    }
    function deletePendingDeposit(){
        alert('delete')
    }
</script>


</body>

</html>